---
title: E-COM 2- Setting up MongoDB to use with Java and Spring
author: Silesh Chandran
date: 2021-05-07 20:10:00 +0530
categories: [backend, projects]
tags: [backend, java, spring, rest, mongodb, projects]
toc: true
comments: true
---

This post will go over how to setup MongoDB (atlas) and move the storage of our product list over rather than keep it in memory. We will also see how to make use of spring repository to make crud operations and object mapping from DB much easier. 

## Getting started with MongoDB
Create an account on mongodb.com. Then create a new cluster on MongoDB Atlas. We can then click on connect to create a db user, make sure to note down the credentials as these will be needed later. To access this directly, download mongoDB compass by clicking connect->"connect using MongoDB compass". Download and run the executable. Then open compass and paste the following:
```
mongodb+srv://<username>:<password>@cluster0.sqirz.mongodb.net/test
```
If there are issues with the IP whitelist, first try adding your public ip under the network access section. If this does not work, then allow access from anywhere and ensure your credentials are strong enough.
Once it connects you should be able to create a database. Create a collection called 'Products', which is where we will store out products. We can make use of compass to see the data in DB as we add and remove using our REST APIs.

## Adding MongoDB driver dependancy
Normally to allow java to work with MongoDB we would need to make use of the MongoDB driver. But since we are using spring, we can make use of the library spring-boot-starter-data-mongodb which is built on top of the java MongoDB driver and spring-data-mongodb.
To your pom, add the following dependancy:
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-data-mongodb</artifactId>
</dependency>

```

## Creating a CRUD repository
Currently our project stores its data in memory, in a hashmap. We need to move this over to the db and expose it with a repository class. To do this we must first make a change to our product class. We need a way to tell spring that our class is meant to be stored in a document storage type db (document store means storing as a json key value pair, which MongoDB excels at). We annotate the product class with ```@Document(collection="Products")``` pointing to our collection and specify which property is the id with ```@Id```.
```java
@Document(collection = "Products")
public class Product {
    @Id
    String productId;
	...
}
```
If the Id is not set, then an autogenerated String value will be used as the Id by MongoDB.

Now on to creating the Repository. The repository class handles operation for one type of object, Product here in our case. We will extend MongoRepository, which itself extends the Spring Crudrepository. We can make our repository an interface for now to avoid defining all declared methods. It is in the format ```MongoRepository<{document class}, {id type}>```

```java
public interface ProductRepository extends MongoRepository<Product, String> {
}
```
There is no need to define any methods as we will only be using the predefined CRUD operations provided as can be seen later.

## Modifying Controller
In the previous post, we were making use of a Store class to keep track of our product map. We wont require that anymore, and can directly make use of the ProductRepository created. The APIs logic will also be changed to make use of the predefined CRUD methods from the repository. The methods used are findAll, findById, deleteById and insert. FindbyId returns an object of type Optional, which is a container object that may or may not contain a non null value. This is helpful as it makes for easier null checks and handling.

```java
@RestController
public class ProductListingController {
    @Autowired
    ProductRepository productRepository;
	
    @GetMapping(path = "/products")
    public List<Product> getProducts(){
        return productRepository.findAll();
    }

    @PostMapping(path = "/products")
    public String addProduct(@RequestBody Product product){
        productRepository.insert(product);
        return String.format("Added product: %s",product.getProductId());
    }

    @GetMapping(path = "/products/{productId}")
    public Optional<Product> getProcductById(@PathVariable String productId){
        return productRepository.findById(productId);
    }

    @DeleteMapping(path = "/products/{productId}")
    public String deleteProduct(@PathVariable String productId){
        productRepository.deleteById(productId);
        return String.format("deleted product: %s",productId);
    }
}
```
## Connecting to DB
To connect our application to our DB, first go to the mongoDB website and select your cluster. Then click on Connect->Connect your application. Selecting Java and version as 4.1 gives you a connection string. We need to include this in our project with the proper credentials. 
In the resources folder of your project, there is a file called "application.properties". We need to paste the string copied as a new property.
```
spring.data.mongodb.uri = mongodb+srv://<username>:<password>@cluster0.sqirz.mongodb.net/<Database>?retryWrites=true&w=majority
```

## Testing the APIs
To start the server simply right click the main application.java file and select ```run as Java application```.
In addition to being able to view the products using the get api, we will also be able to see the data directly by connecting to the DB from MongoDB compass.

![Desktop View](../../assets/img/ECOM/mongodb.png)
_See the product details_


## Whats next?
Now that we have a DB, we can start adding more complex operations and APIs to flesh out this budding ecommerece platform. We will add Users and Sellers, and enable each user to keep track of objects they want to purchase with a shopping cart. Thanks for reading!